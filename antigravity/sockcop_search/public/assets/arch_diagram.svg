<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 400">
  <defs>
    <style>
      .bg { fill: #0f172a; }
      .text-title { font-family: 'Courier New', monospace; font-size: 24px; font-weight: 700; fill: #f8fafc; letter-spacing: 2px; }
      .text-body { font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; fill: #f8fafc; }
      .text-small { font-family: 'Courier New', monospace; font-size: 11px; font-weight: 500; fill: #94a3b8; }
      
      .line-main { stroke: #38bdf8; stroke-width: 2; fill: none; }
      .line-glow { stroke: rgba(56, 189, 248, 0.4); stroke-width: 6; fill: none; filter: blur(3px); }
      .line-dash { stroke: #64748b; stroke-width: 1.5; stroke-dasharray: 6 6; fill: none; }
      
      .box-entra { fill: rgba(139, 92, 246, 0.1); stroke: #8b5cf6; stroke-width: 2; rx: 8; ry: 8; }
      .box-gcp { fill: rgba(16, 185, 129, 0.1); stroke: #10b981; stroke-width: 2; rx: 8; ry: 8; }
      .box-vertex { fill: rgba(245, 158, 11, 0.1); stroke: #f59e0b; stroke-width: 2; rx: 8; ry: 8; }
      .box-sharepoint { fill: #1e293b; stroke: #475569; stroke-width: 1; rx: 4; ry: 4; }
    </style>
    
    <filter id="glow">
      <feGaussianBlur stdDeviation="5" result="blur" />
      <feMerge>
        <feMergeNode in="blur" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>

    <marker id="arrow-blue" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#38bdf8" />
    </marker>
    <marker id="arrow-gray" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#64748b" />
    </marker>
  </defs>

  <rect class="bg" width="1000" height="400" />
  
  <g opacity="0.1">
    <path class="line-dash" d="M0,50 L1000,50 M0,100 L1000,100 M0,150 L1000,150 M0,200 L1000,200 M0,250 L1000,250 M0,300 L1000,300 M0,350 L1000,350" />
    <path class="line-dash" d="M100,0 L100,400 M200,0 L200,400 M300,0 L300,400 M400,0 L400,400 M500,0 L500,400 M600,0 L600,400 M700,0 L700,400 M800,0 L800,400 M900,0 L900,400" />
  </g>

  <!-- Title with animated cursor -->
  <text x="40" y="45" class="text-title">FEDERATION_ARCHITECTURE<tspan fill="#38bdf8"><animate attributeName="opacity" values="1;0;1" dur="1s" repeatCount="indefinite" />_</tspan></text>

  
  <!-- Auth Flow (Token Exchange Sequence) -->
  
  <!-- Step 1: Microsoft Entra Token to WIF -->
  <circle r="4" fill="#ffffff" filter="url(#glow)">
    <animateMotion dur="3s" repeatCount="indefinite" path="M 260 130 L 360 130" keyPoints="0;1" keyTimes="0;1" calcMode="linear"/>
  </circle>
  
  <!-- Step 2: GCP STS Token to Vertex AI API -->
  <circle r="4" fill="#38bdf8" filter="url(#glow)">
    <animateMotion dur="2s" repeatCount="indefinite" path="M 430 170 L 430 230" begin="2s" keyPoints="0;1" keyTimes="0;1" calcMode="linear" />
  </circle>

  <!-- Step 3: API Query Execution to SharePoint -->
  <circle r="4" fill="#10b981" filter="url(#glow)">
    <animateMotion dur="2s" repeatCount="indefinite" path="M 540 270 L 640 270" begin="4s" keyPoints="0;1" keyTimes="0;1" calcMode="linear" />
  </circle>

  <!-- Background Sync Flow -->
  <circle r="4" fill="#f59e0b" filter="url(#glow)">
    <animateMotion dur="4s" repeatCount="indefinite" path="M 640 270 L 540 270" />
  </circle>
  <circle r="4" fill="#f59e0b" filter="url(#glow)">
    <animateMotion dur="4s" repeatCount="indefinite" path="M 260 270 L 360 270" />
  </circle>
<g transform="translate(40, 90)">
    <!-- Nodes Phase 1 -->
    <rect class="box-entra" width="220" height="80" />
    <text x="20" y="30" class="text-body">Entra ID UI App</text>
    <text x="20" y="50" class="text-small">deloitte-entraid</text>
    <text x="20" y="65" class="text-small" fill="#8b5cf6">Primary Identity Provider</text>

    <rect class="box-gcp" x="320" y="0" width="220" height="80" />
    <text x="340" y="30" class="text-body">WF Identity Federation</text>
    <text x="340" y="50" class="text-small">entra-id-pool-d</text>
    <text x="340" y="65" class="text-small" fill="#10b981">Google Cloud Boundary</text>

    <rect class="box-gcp" x="640" y="0" width="220" height="80" />
    <text x="660" y="30" class="text-body">GCP IAM Bindings</text>
    <text x="660" y="50" class="text-small">principalSet://...</text>
    <text x="660" y="65" class="text-small" fill="#10b981">Vertex AI User Roles</text>

    <!-- Phase 1 Lines -->
    <path class="line-glow" d="M 220 40 L 320 40" />
    <path class="line-main" d="M 220 40 L 320 40" marker-end="url(#arrow-blue)" />
    <text x="230" y="30" class="text-small">Microsoft Entra Token</text>

    <path class="line-glow" d="M 540 40 L 640 40" />
    <path class="line-main" d="M 540 40 L 640 40" marker-end="url(#arrow-blue)" />
    <text x="560" y="30" class="text-small">STS Token Validated</text>
  </g>

  <g transform="translate(40, 230)">
    <!-- Nodes Phase 2 -->
    <rect class="box-entra" width="220" height="80" />
    <text x="20" y="30" class="text-body">Entra ID Sync App</text>
    <text x="20" y="50" class="text-small">sharepoint-store</text>
    <text x="20" y="65" class="text-small" fill="#8b5cf6">Service Principal</text>

    <rect class="box-vertex" x="320" y="0" width="220" height="80" />
    <text x="340" y="30" class="text-body">Vertex AI Search</text>
    <text x="340" y="50" class="text-small">deloitte-demo engine</text>
    <text x="340" y="65" class="text-small" fill="#f59e0b">SharePoint Connector</text>
    
    <rect class="box-sharepoint" x="640" y="0" width="220" height="80" />
    <text x="660" y="45" class="text-body">Microsoft SharePoint</text>

    <!-- Phase 2 Lines -->
    <path class="line-glow" d="M 220 40 L 320 40" />
    <path class="line-main" d="M 220 40 L 320 40" marker-end="url(#arrow-blue)" />
    <text x="230" y="30" class="text-small">Client Secret</text>

    <path class="line-dash" d="M 540 40 L 640 40" marker-start="url(#arrow-gray)" marker-end="url(#arrow-gray)" />
    <text x="550" y="30" class="text-small">Background Sync</text>
  </g>

  <!-- Discovery Engine API Query Line -->
  <path class="line-glow" d="M 430 80 C 430 200, 430 200, 430 230" />
  <path class="line-main" d="M 430 80 C 430 200, 430 200, 430 230" marker-end="url(#arrow-blue)" />
  <text x="440" y="150" class="text-small">GCP STS Token Handshake</text>
  <text x="440" y="165" class="text-small">Permits DiscoveryEngine API</text>

</svg>